<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />


<meta name="author" content="Annie Xie" />

<meta name="date" content="2024-07-29" />

<title>8-population-example</title>

<script src="site_libs/header-attrs-2.27/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/cosmo.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/jqueryui-1.13.2/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/textmate.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<link href="site_libs/font-awesome-6.4.2/css/all.min.css" rel="stylesheet" />
<link href="site_libs/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet" />

<link rel="icon" href="https://github.com/workflowr/workflowr-assets/raw/main/img/reproducible.png">
<!-- Add a small amount of space between sections. -->
<style type="text/css">
div.section {
  padding-top: 12px;
}
</style>



<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>









<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark the anchor link active (and if it's in a dropdown, also mark that active)
  var dropdown = menuAnchor.closest('li.dropdown');
  if (window.bootstrap) { // Bootstrap 4+
    menuAnchor.addClass('active');
    dropdown.find('> .dropdown-toggle').addClass('active');
  } else { // Bootstrap 3
    menuAnchor.parent().addClass('active');
    dropdown.addClass('active');
  }

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before, .tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "\e259";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "\e258";
  font-family: 'Glyphicons Halflings';
  border: none;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-bs-toggle="collapse" data-target="#navbar" data-bs-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">drift_matrix_factorization</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li>
  <a href="about.html">About</a>
</li>
<li>
  <a href="license.html">License</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/xxie6/drift_matrix_factorization">
    <span class="fab fa-github"></span>
     
    Source code
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">



<h1 class="title toc-ignore">8-population-example</h1>
<h4 class="author">Annie Xie</h4>
<h4 class="date">2024-07-29</h4>

</div>


<p>
<button type="button" class="btn btn-default btn-workflowr btn-workflowr-report" data-toggle="collapse" data-target="#workflowr-report">
<span class="glyphicon glyphicon-list" aria-hidden="true"></span>
workflowr <span class="glyphicon glyphicon-ok text-success"
aria-hidden="true"></span>
</button>
</p>
<div id="workflowr-report" class="collapse">
<ul class="nav nav-tabs">
<li class="active">
<a data-toggle="tab" href="#summary">Summary</a>
</li>
<li>
<a data-toggle="tab" href="#checks"> Checks <span
class="glyphicon glyphicon-ok text-success" aria-hidden="true"></span>
</a>
</li>
<li>
<a data-toggle="tab" href="#versions">Past versions</a>
</li>
</ul>
<div class="tab-content">
<div id="summary" class="tab-pane fade in active">
<p>
<strong>Last updated:</strong> 2024-08-07
</p>
<p>
<strong>Checks:</strong> <span
class="glyphicon glyphicon-ok text-success" aria-hidden="true"></span> 7
<span class="glyphicon glyphicon-exclamation-sign text-danger"
aria-hidden="true"></span> 0
</p>
<p>
<strong>Knit directory:</strong>
<code>drift_matrix_factorization/</code> <span
class="glyphicon glyphicon-question-sign" aria-hidden="true"
title="This is the local directory in which the code in this file was executed.">
</span>
</p>
<p>
This reproducible <a href="https://rmarkdown.rstudio.com">R Markdown</a>
analysis was created with <a
  href="https://github.com/workflowr/workflowr">workflowr</a> (version
1.7.1). The <em>Checks</em> tab describes the reproducibility checks
that were applied when the results were created. The <em>Past
versions</em> tab lists the development history.
</p>
<hr>
</div>
<div id="checks" class="tab-pane fade">
<div id="workflowr-checks" class="panel-group">
<div class="panel panel-default">
<div class="panel-heading">
<p class="panel-title">
<a data-toggle="collapse" data-parent="#workflowr-checks" href="#strongRMarkdownfilestronguptodate">
<span class="glyphicon glyphicon-ok text-success"
aria-hidden="true"></span> <strong>R Markdown file:</strong> up-to-date
</a>
</p>
</div>
<div id="strongRMarkdownfilestronguptodate"
class="panel-collapse collapse">
<div class="panel-body">
<p>Great! Since the R Markdown file has been committed to the Git
repository, you know the exact version of the code that produced these
results.</p>
</div>
</div>
</div>
<div class="panel panel-default">
<div class="panel-heading">
<p class="panel-title">
<a data-toggle="collapse" data-parent="#workflowr-checks" href="#strongEnvironmentstrongempty">
<span class="glyphicon glyphicon-ok text-success"
aria-hidden="true"></span> <strong>Environment:</strong> empty </a>
</p>
</div>
<div id="strongEnvironmentstrongempty" class="panel-collapse collapse">
<div class="panel-body">
<p>Great job! The global environment was empty. Objects defined in the
global environment can affect the analysis in your R Markdown file in
unknown ways. For reproduciblity it’s best to always run the code in an
empty environment.</p>
</div>
</div>
</div>
<div class="panel panel-default">
<div class="panel-heading">
<p class="panel-title">
<a data-toggle="collapse" data-parent="#workflowr-checks" href="#strongSeedstrongcodesetseed20240416code">
<span class="glyphicon glyphicon-ok text-success"
aria-hidden="true"></span> <strong>Seed:</strong>
<code>set.seed(20240416)</code> </a>
</p>
</div>
<div id="strongSeedstrongcodesetseed20240416code"
class="panel-collapse collapse">
<div class="panel-body">
<p>The command <code>set.seed(20240416)</code> was run prior to running
the code in the R Markdown file. Setting a seed ensures that any results
that rely on randomness, e.g. subsampling or permutations, are
reproducible.</p>
</div>
</div>
</div>
<div class="panel panel-default">
<div class="panel-heading">
<p class="panel-title">
<a data-toggle="collapse" data-parent="#workflowr-checks" href="#strongSessioninformationstrongrecorded">
<span class="glyphicon glyphicon-ok text-success"
aria-hidden="true"></span> <strong>Session information:</strong>
recorded </a>
</p>
</div>
<div id="strongSessioninformationstrongrecorded"
class="panel-collapse collapse">
<div class="panel-body">
<p>Great job! Recording the operating system, R version, and package
versions is critical for reproducibility.</p>
</div>
</div>
</div>
<div class="panel panel-default">
<div class="panel-heading">
<p class="panel-title">
<a data-toggle="collapse" data-parent="#workflowr-checks" href="#strongCachestrongnone">
<span class="glyphicon glyphicon-ok text-success"
aria-hidden="true"></span> <strong>Cache:</strong> none </a>
</p>
</div>
<div id="strongCachestrongnone" class="panel-collapse collapse">
<div class="panel-body">
<p>Nice! There were no cached chunks for this analysis, so you can be
confident that you successfully produced the results during this
run.</p>
</div>
</div>
</div>
<div class="panel panel-default">
<div class="panel-heading">
<p class="panel-title">
<a data-toggle="collapse" data-parent="#workflowr-checks" href="#strongFilepathsstrongrelative">
<span class="glyphicon glyphicon-ok text-success"
aria-hidden="true"></span> <strong>File paths:</strong> relative </a>
</p>
</div>
<div id="strongFilepathsstrongrelative" class="panel-collapse collapse">
<div class="panel-body">
<p>Great job! Using relative paths to the files within your workflowr
project makes it easier to run your code on other machines.</p>
</div>
</div>
</div>
<div class="panel panel-default">
<div class="panel-heading">
<p class="panel-title">
<a data-toggle="collapse" data-parent="#workflowr-checks" href="#strongRepositoryversionstrongahrefhttpsgithubcomxxie6driftmatrixfactorizationtreeb516bce41d7a3989f59fcdf4dcd2de5e34c3b0f0targetblankb516bcea">
<span class="glyphicon glyphicon-ok text-success"
aria-hidden="true"></span> <strong>Repository version:</strong>
<a href="https://github.com/xxie6/drift_matrix_factorization/tree/b516bce41d7a3989f59fcdf4dcd2de5e34c3b0f0" target="_blank">b516bce</a>
</a>
</p>
</div>
<div
id="strongRepositoryversionstrongahrefhttpsgithubcomxxie6driftmatrixfactorizationtreeb516bce41d7a3989f59fcdf4dcd2de5e34c3b0f0targetblankb516bcea"
class="panel-collapse collapse">
<div class="panel-body">
<p>
Great! You are using Git for version control. Tracking code development
and connecting the code version to the results is critical for
reproducibility.
</p>
<p>
The results in this page were generated with repository version
<a href="https://github.com/xxie6/drift_matrix_factorization/tree/b516bce41d7a3989f59fcdf4dcd2de5e34c3b0f0" target="_blank">b516bce</a>.
See the <em>Past versions</em> tab to see a history of the changes made
to the R Markdown and HTML files.
</p>
<p>
Note that you need to be careful to ensure that all relevant files for
the analysis have been committed to Git prior to generating the results
(you can use <code>wflow_publish</code> or
<code>wflow_git_commit</code>). workflowr only checks the R Markdown
file, but you know if there are other scripts or data files that it
depends on. Below is the status of the Git repository when the results
were generated:
</p>
<pre><code>
Ignored files:
    Ignored:    .DS_Store
    Ignored:    .Rhistory

</code></pre>
<p>
Note that any generated files, e.g. HTML, png, CSS, etc., are not
included in this status report because it is ok for generated content to
have uncommitted changes.
</p>
</div>
</div>
</div>
</div>
<hr>
</div>
<div id="versions" class="tab-pane fade">

<p>
These are the previous versions of the repository in which changes were
made to the R Markdown (<code>analysis/8-population-example.Rmd</code>)
and HTML (<code>docs/8-population-example.html</code>) files. If you’ve
configured a remote Git repository (see <code>?wflow_git_remote</code>),
click on the hyperlinks in the table below to view the files as they
were in that past version.
</p>
<div class="table-responsive">
<table class="table table-condensed table-hover">
<thead>
<tr>
<th>
File
</th>
<th>
Version
</th>
<th>
Author
</th>
<th>
Date
</th>
<th>
Message
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
Rmd
</td>
<td>
<a href="https://github.com/xxie6/drift_matrix_factorization/blob/b516bce41d7a3989f59fcdf4dcd2de5e34c3b0f0/analysis/8-population-example.Rmd" target="_blank">b516bce</a>
</td>
<td>
Annie Xie
</td>
<td>
2024-08-07
</td>
<td>
Edit text
</td>
</tr>
<tr>
<td>
html
</td>
<td>
<a href="https://rawcdn.githack.com/xxie6/drift_matrix_factorization/22aaf9bef5672c3058cd44622274ddc9d64ab055/docs/8-population-example.html" target="_blank">22aaf9b</a>
</td>
<td>
Annie Xie
</td>
<td>
2024-08-05
</td>
<td>
Build site.
</td>
</tr>
<tr>
<td>
Rmd
</td>
<td>
<a href="https://github.com/xxie6/drift_matrix_factorization/blob/ba9b6487af10d176126eda936a66f2965e33bfd0/analysis/8-population-example.Rmd" target="_blank">ba9b648</a>
</td>
<td>
Annie Xie
</td>
<td>
2024-08-05
</td>
<td>
Add examples with standardized loadings vectors
</td>
</tr>
</tbody>
</table>
</div>
<hr>
</div>
</div>
</div>
<div id="introduction" class="section level1">
<h1>Introduction</h1>
<p>In our previous analysis, we tested our distance-based regression
method on 4 population data generated from a balanced tree. We wanted
the method to recover a drift factorization. However, we found that the
method was finding a different factorization. After further
investigation, Matthew found an example where a different factorization
provided a perfect fit (in the case of no noise) but its coefficients
had a smaller L1 norm than the coefficients associated with the drift
factorization. After finding this example, Matthew commented that we not
only want our coefficients to be sparse, but we also want the chosen
loadings vectors to also be sparse. In EBMF, this preference is directly
encoded by placing a sparse prior on the loadings. However, it is
unclear how to encode this preference in the regression setting. Matthew
suggested trying to normalize the loadings vectors such that they have
l1-norm equal to 1. This method is a little ad-hoc, but it seems like it
should be able to capture the preference for sparse loadings vectors.
Vectors that are not sparse will need higher coefficients due to the
normalization of the vectors.</p>
<p>In this analysis, we want to test out this new method. We first test
it out on the 4 population example. (Here, we consider no noise.) Then
we will test out the method on a 8 population example where the data is
generated from a balanced tree.</p>
</div>
<div id="packages-and-function-for-analyses" class="section level1">
<h1>Packages and function for analyses</h1>
<pre class="r"><code>library(ggplot2)
library(pheatmap)
library(NNLM)</code></pre>
<pre class="r"><code>plot_heatmap &lt;- function(L, title = &quot;&quot;){
  ### define the color map
  cols &lt;- colorRampPalette(c(&quot;gray96&quot;, &quot;red&quot;))(49)
  brks &lt;- seq(min(L), max(L), length=50)
  
  plt &lt;- pheatmap(L, show_rownames = FALSE, show_colnames = FALSE, cluster_rows = FALSE, cluster_cols = FALSE, color = cols, breaks = brks, main = title)
  return(plt)
}</code></pre>
<pre class="r"><code>structure_plot_general = function(Lhat,Fhat,grouping,title=NULL, loadings_order = &#39;embed&#39;, print_plot=FALSE, seed=12345, n_samples = NULL, gap=40, show_legend=TRUE, K = NULL, plot.colors = NULL, normalize = FALSE){
  set.seed(seed)

  #if not told to plot all samples, then plot a sub-sample
  if(is.null(n_samples)&amp;all(loadings_order == &quot;embed&quot;)){
    n_samples = 2000
  }
  
  if(is.null(plot.colors)){
    plot.colors &lt;- rainbow(ncol(Lhat))
  }

  #normalize L such that each factor has a maximum loading value of 1
  #results in an error if all the entries of a column are 0
  # this doesn&#39;t do the normalization if all the entries are below 1 (think about!)
  if (normalize == TRUE){
    Lhat = apply(Lhat,2,function(z){z/max(max(z),0.00001)})
  }
  
  #if not told to plot all factors, then plot the requested subset
  if(!is.null(K)){
    Lhat = Lhat[,1:K]
    Fhat = Fhat[,1:K]
  }
  
  Fhat = matrix(1,nrow=3,ncol=ncol(Lhat))
  
  #add column names to Lhat if it doesn&#39;t have column names
  if(is.null(colnames(Lhat))){
    colnames(Lhat) &lt;- paste0(&quot;k&quot;,1:ncol(Lhat))
  }
  
  #define multinom_topic_model_fit for structure plot function
  fit_list &lt;- list(L = Lhat,F = Fhat)
  class(fit_list) &lt;- c(&quot;multinom_topic_model_fit&quot;, &quot;list&quot;)
  
  #plot
  p &lt;- fastTopics::structure_plot(fit_list,grouping = grouping, loadings_order = loadings_order, n = n_samples, colors = plot.colors, gap = gap,verbose=F) + labs(y = &quot;loading&quot;,color = &quot;dim&quot;,fill = &quot;dim&quot;) + ggtitle(title)
  if(!show_legend){
    p &lt;- p + theme(legend.position=&quot;none&quot;)
  }
  if(print_plot){
    print(p)
  }
  return(p)
}</code></pre>
<pre class="r"><code>regression_obj_function &lt;- function(y,x,beta,lambda){
  obj_val &lt;- mean((as.matrix(y, ncol = 1) - x%*%as.matrix(beta, ncol = 1))^2) + lambda*sum(abs(beta))
  return(obj_val)
}</code></pre>
<pre class="r"><code>obj_function_from_fit &lt;- function(fit.regression, alpha_l1){
  return(fit.regression$nnlm_fit$error[[&#39;MSE&#39;]] + alpha_l1*sum(abs(fit.regression$nnlm_fit$coefficients)))
}</code></pre>
<div id="functions-for-the-penalized-regression" class="section level2">
<h2>Functions for the penalized regression</h2>
<pre class="r"><code>compute_distance &lt;- function(X = NULL, crossprod_X = NULL){
  #crossprod_X &lt;- X %*% t(X) # assume X is samples by features
  if (is.null(crossprod_X) == TRUE){
    crossprod_X &lt;- tcrossprod(X)
  }
  alpha &lt;- diag(crossprod_X) 
  n &lt;- length(alpha)
  D &lt;- as.matrix(alpha) %*% t(rep(1, n)) + as.matrix(rep(1,n)) %*% t(alpha) - 2*crossprod_X
  return(D)
}</code></pre>
<pre class="r"><code>compute_vector_distance_matrix &lt;- function(l_k){
  l_k_distance &lt;- stats::dist(as.matrix(l_k), diag = FALSE) #this only outputs lower triangular part (not including diagonal)
  return(l_k_distance)
}</code></pre>
<pre class="r"><code>#small sample workflow
distance_matrix_factorization_standardized &lt;- function(P = NULL, alpha_l1 = 0, dist_matrix = NULL, no_singleton = FALSE){
  if (is.null(dist_matrix) == TRUE){
    dist_matrix &lt;- compute_distance(P)
    n = nrow(P) # assume P is samples by features
    print(n)
  }
  else{
    n &lt;- nrow(dist_matrix)
  }
  
  # get the options for the binary loadings vectors
  L_options &lt;- t(expand.grid(replicate(n, 0:1, simplify = FALSE)))
  num_of_ones &lt;- colSums(L_options)
  L_options &lt;- L_options[,(num_of_ones &lt;= (n/2))] 
  
  #if n/2 is even 
  idx_halfn &lt;- L_options[,(colSums(L_options) == (n/2))]
  test_corr &lt;- cor(idx_halfn, idx_halfn)
  
  mytol &lt;- 1e-10
  test_complement &lt;- (abs(test_corr - (-1)) &lt; mytol)
  complements &lt;- which(test_complement, arr.ind = TRUE)
  complements_keep &lt;- complements[c(1:(nrow(complements)/2)), 2] #might need to change this
  L_options &lt;- cbind(L_options[,(colSums(L_options) &lt; (n/2))], idx_halfn[,complements_keep])
  
  # drop vector that is all zeros (the distance will be zero so it doesn&#39;t contribute in   the regression model)
  L_options &lt;- L_options[, !(colSums(L_options) == 0)]
  
  if (no_singleton == TRUE){
    L_options &lt;- L_options[, (colSums(L_options) != 1)]
  }
  
  # standardize the l vectors in the L_options matrix
  L_options &lt;- t(t(L_options)/colSums(L_options))
  
  # Fit the regression
  # I just fit off-diagonals since the diagonals of a distance matrix are zero
  # I just fit the lower-triangular part since a distance matrix is symmetric
  LLt_options &lt;- matrix(rep(0, ncol(L_options)*(0.5*n*(n-1))), ncol = ncol(L_options))
  for (i in 1:ncol(L_options)){
    LLt_options[,i] &lt;- c(compute_vector_distance_matrix(L_options[,i])) 
  }

  D_lower &lt;- lower.tri(dist_matrix, diag = FALSE)
  D_lower_vec &lt;- c(dist_matrix)[c(D_lower)]
  nnlm_fit &lt;- nnlm(LLt_options^2, as.matrix(D_lower_vec, ncol = 1), alpha = c(0,0,alpha_l1))
  
  indices_keep &lt;- (nnlm_fit$coefficients &gt; 0)
  lambda &lt;- nnlm_fit$coefficients[indices_keep]
  X_keep &lt;- LLt_options[,indices_keep]
  
  L_est &lt;- L_options[,indices_keep] %*% diag(sqrt(lambda))
  
  dist_est_vals &lt;- LLt_options %*% nnlm_fit$coefficients
  dist_est &lt;- matrix(rep(0, n*n), ncol = n)
  dist_est[lower.tri(dist_est,diag=FALSE)] &lt;- dist_est_vals
  dist_est &lt;- as.matrix(Matrix::forceSymmetric(dist_est, uplo=&quot;L&quot;))
  
  return(list(nnlm_fit = nnlm_fit, lambda = lambda, L_unscaled = L_options[,indices_keep], L_est = L_est, dist_est = dist_est))
}</code></pre>
<pre class="r"><code>#small sample workflow
distance_matrix_factorization &lt;- function(P = NULL, alpha_l1 = 0, dist_matrix = NULL){
  if (is.null(dist_matrix) == TRUE){
    dist_matrix &lt;- compute_distance(P)
    n = nrow(P) # assume P is samples by features
    print(n)
  }
  else{
    n &lt;- nrow(dist_matrix)
  }
  
  L_options &lt;- t(expand.grid(replicate(n, 0:1, simplify = FALSE)))
  num_of_ones &lt;- colSums(L_options)
  L_options &lt;- L_options[,(num_of_ones &lt;= (n/2))]
  
  #if n/2 is even 
  idx_halfn &lt;- L_options[,(colSums(L_options) == (n/2))]
  test_corr &lt;- cor(idx_halfn, idx_halfn)
  mytol &lt;- 1e-10
  test_complement &lt;- (abs(test_corr - (-1)) &lt; mytol)
  complements &lt;- which(test_complement, arr.ind = TRUE)
  complements_keep &lt;- complements[c(1:(nrow(complements)/2)), 2] #might need to change this
  L_options &lt;- cbind(L_options[,(colSums(L_options) &lt; (n/2))], idx_halfn[,complements_keep])
  
  L_options &lt;- L_options[,(colSums(L_options) != 0)]
  
  #I just fit off-diagonals since the diagonals of a distance matrix are zero
  #I just fit the lower-triangular part since a distance matrix is symmetric
  LLt_options &lt;- matrix(rep(0, (ncol(L_options)*(0.5*n*(n-1)))), ncol = ncol(L_options))
  for (i in 1:ncol(L_options)){
    LLt_options[,i] &lt;- c(compute_vector_distance_matrix(L_options[,i])) 
  }

  D_lower &lt;- lower.tri(dist_matrix, diag = FALSE)
  D_lower_vec &lt;- c(dist_matrix)[c(D_lower)]
  nnlm_fit &lt;- nnlm(LLt_options, as.matrix(D_lower_vec, ncol = 1), alpha = c(0,0,alpha_l1))
  
  indices_keep &lt;- (nnlm_fit$coefficients &gt; 0)
  lambda &lt;- nnlm_fit$coefficients[indices_keep]
  X_keep &lt;- LLt_options[,indices_keep]
  
  L_est &lt;- L_options[,indices_keep] %*% diag(sqrt(lambda)) # double check this
  
  dist_est_vals &lt;- LLt_options %*% nnlm_fit$coefficients
  dist_est &lt;- matrix(rep(0, n*n), ncol = n)
  dist_est[lower.tri(dist_est,diag=FALSE)] &lt;- dist_est_vals
  dist_est &lt;- as.matrix(Matrix::forceSymmetric(dist_est, uplo=&quot;L&quot;))
  
  return(list(nnlm_fit = nnlm_fit, L_est = L_est, dist_est = dist_est))
}</code></pre>
</div>
</div>
<div id="population-example-with-no-noise" class="section level1">
<h1>4 Population Example (with no noise)</h1>
<p>In this example, we will test this method on 4 population data
generated from a balanced tree with no noise.</p>
<div id="data-generation" class="section level2">
<h2>Data Generation</h2>
<pre class="r"><code># modified from Jason&#39;s code
sim_4pops_no_noise &lt;- function(
                      seed = 666) {
  set.seed(seed)

  n &lt;- 4

  LL &lt;- matrix(0, nrow = n, ncol = 7)
  LL[, 1] &lt;- 1
  LL[, 2] &lt;- c(1, 1, 0, 0)
  LL[, 3] &lt;- c(0, 0, 1, 1)
  LL[, c(4:7)] &lt;- diag(rep(1,n))

  LLt &lt;- tcrossprod(LL)
  D2 &lt;- compute_distance(crossprod_X = LLt)
  
  return(list(D2 = D2, LL = LL))
}</code></pre>
<pre class="r"><code>dist_data_4pop &lt;- sim_4pops_no_noise()</code></pre>
<pre class="r"><code>dist_data_4pop$D2</code></pre>
<pre><code>     [,1] [,2] [,3] [,4]
[1,]    0    2    4    4
[2,]    2    0    4    4
[3,]    4    4    0    2
[4,]    4    4    2    0</code></pre>
</div>
<div id="the-split-decomposition-we-want" class="section level2">
<h2>The split decomposition we want</h2>
<p>This is the split decomposition that we want the method to
recover:</p>
<pre class="r"><code>l1 &lt;- stats::dist((1/2)*c(1, 1, 0, 0), diag = TRUE, upper = TRUE)
l2 &lt;- stats::dist(c(1, 0, 0, 0), diag = TRUE, upper = TRUE)
l3 &lt;- stats::dist(c(0, 1, 0, 0), diag = TRUE, upper = TRUE)
l4 &lt;- stats::dist(c(0, 0, 1, 0), diag = TRUE, upper = TRUE)
l5 &lt;- stats::dist(c(0, 0, 0, 1), diag = TRUE, upper = TRUE)</code></pre>
<pre class="r"><code>8*l1^2 + l2^2 + l3^2 + l4^2 + l5^2</code></pre>
<pre><code>  1 2 3 4
1 0 2 4 4
2 2 0 4 4
3 4 4 0 2
4 4 4 2 0</code></pre>
<p>The coefficients have l1 norm = 12.</p>
</div>
<div id="using-penalized-regression-to-factorize"
class="section level2">
<h2>Using Penalized Regression to factorize</h2>
<div id="hypothesis" class="section level3">
<h3>Hypothesis</h3>
<p>Based off of the example that Matthew presented, I hypothesize that
the new distance-based regression method (using standardized loadings
vectors) will recover the drift factorization.</p>
</div>
<div id="analysis" class="section level3">
<h3>Analysis</h3>
<p>This is a heatmap of the distance matrix:</p>
<pre class="r"><code>plot_heatmap(dist_data_4pop$D2)</code></pre>
<p><img src="figure/8-population-example.Rmd/unnamed-chunk-15-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>
<button type="button" class="btn btn-default btn-xs btn-workflowr btn-workflowr-fig" data-toggle="collapse" data-target="#fig-unnamed-chunk-15-1">
Past versions of unnamed-chunk-15-1.png
</button>
</p>
<div id="fig-unnamed-chunk-15-1" class="collapse">
<div class="table-responsive">
<table class="table table-condensed table-hover">
<thead>
<tr>
<th>
Version
</th>
<th>
Author
</th>
<th>
Date
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<a href="https://github.com/xxie6/drift_matrix_factorization/blob/22aaf9bef5672c3058cd44622274ddc9d64ab055/docs/figure/8-population-example.Rmd/unnamed-chunk-15-1.png" target="_blank">22aaf9b</a>
</td>
<td>
Annie Xie
</td>
<td>
2024-08-05
</td>
</tr>
</tbody>
</table>
</div>
</div>
<pre class="r"><code>set.seed(2042)
fit.regression_4pop &lt;- distance_matrix_factorization_standardized(dist_matrix = dist_data_4pop$D2, alpha_l1 = 10^(-10))</code></pre>
<pre><code>Warning in nnlm(LLt_options^2, as.matrix(D_lower_vec, ncol = 1), alpha = c(0, :
x does not have a full column rank. Solution may not be unique.</code></pre>
<pre class="r"><code>dist_est_4pop &lt;- fit.regression_4pop$dist_est</code></pre>
<p>This is a heatmap of the estimated distance matrix:</p>
<pre class="r"><code>plot_heatmap(dist_est_4pop)</code></pre>
<p><img src="figure/8-population-example.Rmd/unnamed-chunk-18-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>
<button type="button" class="btn btn-default btn-xs btn-workflowr btn-workflowr-fig" data-toggle="collapse" data-target="#fig-unnamed-chunk-18-1">
Past versions of unnamed-chunk-18-1.png
</button>
</p>
<div id="fig-unnamed-chunk-18-1" class="collapse">
<div class="table-responsive">
<table class="table table-condensed table-hover">
<thead>
<tr>
<th>
Version
</th>
<th>
Author
</th>
<th>
Date
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<a href="https://github.com/xxie6/drift_matrix_factorization/blob/22aaf9bef5672c3058cd44622274ddc9d64ab055/docs/figure/8-population-example.Rmd/unnamed-chunk-18-1.png" target="_blank">22aaf9b</a>
</td>
<td>
Annie Xie
</td>
<td>
2024-08-05
</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>This is a plot of the fitted values vs. observed values:</p>
<pre class="r"><code>ggplot(data = NULL, aes(x = c(dist_data_4pop$D2), y = c(dist_est_4pop))) + geom_point() + geom_abline(intercept = 0, slope = 1, color = &#39;red&#39;) + xlab(&#39;Observed Values&#39;) + ylab(&#39;Fitted Values&#39;)</code></pre>
<p><img src="figure/8-population-example.Rmd/unnamed-chunk-19-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>
<button type="button" class="btn btn-default btn-xs btn-workflowr btn-workflowr-fig" data-toggle="collapse" data-target="#fig-unnamed-chunk-19-1">
Past versions of unnamed-chunk-19-1.png
</button>
</p>
<div id="fig-unnamed-chunk-19-1" class="collapse">
<div class="table-responsive">
<table class="table table-condensed table-hover">
<thead>
<tr>
<th>
Version
</th>
<th>
Author
</th>
<th>
Date
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<a href="https://github.com/xxie6/drift_matrix_factorization/blob/22aaf9bef5672c3058cd44622274ddc9d64ab055/docs/figure/8-population-example.Rmd/unnamed-chunk-19-1.png" target="_blank">22aaf9b</a>
</td>
<td>
Annie Xie
</td>
<td>
2024-08-05
</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>This is a plot of the residuals:</p>
<pre class="r"><code>fit.residuals_4pop &lt;- c(dist_data_4pop$D2) - c(dist_est_4pop)
ggplot(data = NULL, aes(x = c(1:length(fit.residuals_4pop)), y = fit.residuals_4pop)) + geom_point() + geom_hline(yintercept = 0)</code></pre>
<p><img src="figure/8-population-example.Rmd/unnamed-chunk-20-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>
<button type="button" class="btn btn-default btn-xs btn-workflowr btn-workflowr-fig" data-toggle="collapse" data-target="#fig-unnamed-chunk-20-1">
Past versions of unnamed-chunk-20-1.png
</button>
</p>
<div id="fig-unnamed-chunk-20-1" class="collapse">
<div class="table-responsive">
<table class="table table-condensed table-hover">
<thead>
<tr>
<th>
Version
</th>
<th>
Author
</th>
<th>
Date
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<a href="https://github.com/xxie6/drift_matrix_factorization/blob/22aaf9bef5672c3058cd44622274ddc9d64ab055/docs/figure/8-population-example.Rmd/unnamed-chunk-20-1.png" target="_blank">22aaf9b</a>
</td>
<td>
Annie Xie
</td>
<td>
2024-08-05
</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>This is a heatmap of the residuals:</p>
<pre class="r"><code>plot_heatmap(dist_est_4pop - dist_data_4pop$D2)</code></pre>
<p><img src="figure/8-population-example.Rmd/unnamed-chunk-21-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>
<button type="button" class="btn btn-default btn-xs btn-workflowr btn-workflowr-fig" data-toggle="collapse" data-target="#fig-unnamed-chunk-21-1">
Past versions of unnamed-chunk-21-1.png
</button>
</p>
<div id="fig-unnamed-chunk-21-1" class="collapse">
<div class="table-responsive">
<table class="table table-condensed table-hover">
<thead>
<tr>
<th>
Version
</th>
<th>
Author
</th>
<th>
Date
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<a href="https://github.com/xxie6/drift_matrix_factorization/blob/22aaf9bef5672c3058cd44622274ddc9d64ab055/docs/figure/8-population-example.Rmd/unnamed-chunk-21-1.png" target="_blank">22aaf9b</a>
</td>
<td>
Annie Xie
</td>
<td>
2024-08-05
</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>This is the MSE:</p>
<pre class="r"><code>obj_function_from_fit(fit.regression_4pop, 0)</code></pre>
<pre><code>[1] 1.000988e-20</code></pre>
<p>This is the objective function value:</p>
<pre class="r"><code>obj_function_from_fit(fit.regression_4pop, 0.001)</code></pre>
<pre><code>[1] 0.012</code></pre>
</div>
<div id="visualization-of-loadings" class="section level3">
<h3>Visualization of Loadings</h3>
<pre class="r"><code>dim(fit.regression_4pop$L_est)</code></pre>
<pre><code>[1] 4 5</code></pre>
<p>This is a heatmap of the loadings:</p>
<pre class="r"><code>plot_heatmap(fit.regression_4pop$L_est)</code></pre>
<p><img src="figure/8-population-example.Rmd/unnamed-chunk-25-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>
<button type="button" class="btn btn-default btn-xs btn-workflowr btn-workflowr-fig" data-toggle="collapse" data-target="#fig-unnamed-chunk-25-1">
Past versions of unnamed-chunk-25-1.png
</button>
</p>
<div id="fig-unnamed-chunk-25-1" class="collapse">
<div class="table-responsive">
<table class="table table-condensed table-hover">
<thead>
<tr>
<th>
Version
</th>
<th>
Author
</th>
<th>
Date
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<a href="https://github.com/xxie6/drift_matrix_factorization/blob/22aaf9bef5672c3058cd44622274ddc9d64ab055/docs/figure/8-population-example.Rmd/unnamed-chunk-25-1.png" target="_blank">22aaf9b</a>
</td>
<td>
Annie Xie
</td>
<td>
2024-08-05
</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>This is a heatmap of the standardized loadings:</p>
<pre class="r"><code>plot_heatmap(t(t(fit.regression_4pop$L_est)/apply(fit.regression_4pop$L_est,2, max)))</code></pre>
<p><img src="figure/8-population-example.Rmd/unnamed-chunk-26-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>
<button type="button" class="btn btn-default btn-xs btn-workflowr btn-workflowr-fig" data-toggle="collapse" data-target="#fig-unnamed-chunk-26-1">
Past versions of unnamed-chunk-26-1.png
</button>
</p>
<div id="fig-unnamed-chunk-26-1" class="collapse">
<div class="table-responsive">
<table class="table table-condensed table-hover">
<thead>
<tr>
<th>
Version
</th>
<th>
Author
</th>
<th>
Date
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<a href="https://github.com/xxie6/drift_matrix_factorization/blob/22aaf9bef5672c3058cd44622274ddc9d64ab055/docs/figure/8-population-example.Rmd/unnamed-chunk-26-1.png" target="_blank">22aaf9b</a>
</td>
<td>
Annie Xie
</td>
<td>
2024-08-05
</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>This is a structure plot of the loadings:</p>
<pre class="r"><code>structure_plot_general(fit.regression_4pop$L_est, fit.regression_4pop$L_est, 
                       n_samples = 4,
                       plot.colors = rainbow(5), normalize = FALSE)</code></pre>
<p><img src="figure/8-population-example.Rmd/unnamed-chunk-27-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>
<button type="button" class="btn btn-default btn-xs btn-workflowr btn-workflowr-fig" data-toggle="collapse" data-target="#fig-unnamed-chunk-27-1">
Past versions of unnamed-chunk-27-1.png
</button>
</p>
<div id="fig-unnamed-chunk-27-1" class="collapse">
<div class="table-responsive">
<table class="table table-condensed table-hover">
<thead>
<tr>
<th>
Version
</th>
<th>
Author
</th>
<th>
Date
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<a href="https://github.com/xxie6/drift_matrix_factorization/blob/22aaf9bef5672c3058cd44622274ddc9d64ab055/docs/figure/8-population-example.Rmd/unnamed-chunk-27-1.png" target="_blank">22aaf9b</a>
</td>
<td>
Annie Xie
</td>
<td>
2024-08-05
</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>This is a structure plot of the squared loadings:</p>
<pre class="r"><code>structure_plot_general(fit.regression_4pop$L_est^2, fit.regression_4pop$L_est^2, 
                       n_samples = 4,
                       plot.colors = rainbow(5), normalize = FALSE)</code></pre>
<p><img src="figure/8-population-example.Rmd/unnamed-chunk-28-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>
<button type="button" class="btn btn-default btn-xs btn-workflowr btn-workflowr-fig" data-toggle="collapse" data-target="#fig-unnamed-chunk-28-1">
Past versions of unnamed-chunk-28-1.png
</button>
</p>
<div id="fig-unnamed-chunk-28-1" class="collapse">
<div class="table-responsive">
<table class="table table-condensed table-hover">
<thead>
<tr>
<th>
Version
</th>
<th>
Author
</th>
<th>
Date
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<a href="https://github.com/xxie6/drift_matrix_factorization/blob/22aaf9bef5672c3058cd44622274ddc9d64ab055/docs/figure/8-population-example.Rmd/unnamed-chunk-28-1.png" target="_blank">22aaf9b</a>
</td>
<td>
Annie Xie
</td>
<td>
2024-08-05
</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div id="observations" class="section level3">
<h3>Observations</h3>
<p>The regression method was able to find the desired drift
factorization. Four factors correspond to population-specific effects.
The fifth factor corresponds to a shared effect for two of the
populations, differentiating these two populations from the other
two.</p>
<p>I also wanted to note that I tested different weights for the penalty
term. I tried some very small weights, and the regression still returns
5 factors. These 5 factors still capture the same sources of
variation.</p>
</div>
</div>
</div>
<div id="population-example-with-no-noise-1" class="section level1">
<h1>8 Population Example (with no noise)</h1>
<p>In this example, we will test this method on 8 population data
generated from a balanced tree.</p>
<div id="data-generation-1" class="section level2">
<h2>Data Generation</h2>
<pre class="r"><code># modified from Jason&#39;s code
sim_8pops_no_noise &lt;- function(
                      seed = 666) {
  set.seed(seed)

  n &lt;- 8

  LL &lt;- matrix(0, nrow = n, ncol = 15)
  LL[, 1] &lt;- 1
  LL[, 2] &lt;- c(1, 1, 1, 1, 0, 0, 0, 0)
  LL[, 3] &lt;- c(0, 0, 0, 0, 1, 1, 1, 1)
  LL[, 4] &lt;- c(1, 1, 0, 0, 0, 0, 0, 0)
  LL[, 5] &lt;- c(0, 0, 1, 1, 0, 0, 0, 0)
  LL[, 6] &lt;- c(0, 0, 0, 0, 1, 1, 0, 0)
  LL[, 7] &lt;- c(0, 0, 0, 0, 0, 0, 1, 1)
  LL[, c(8:15)] &lt;- diag(rep(1, 8))

  LLt &lt;- tcrossprod(LL)
  D2 &lt;- compute_distance(crossprod_X = LLt)
  
  return(list(D2 = D2, LL = LL))
}</code></pre>
<pre class="r"><code>dist_data_8pop &lt;- sim_8pops_no_noise()</code></pre>
<pre class="r"><code>dist_data_8pop$D2</code></pre>
<pre><code>     [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8]
[1,]    0    2    4    4    6    6    6    6
[2,]    2    0    4    4    6    6    6    6
[3,]    4    4    0    2    6    6    6    6
[4,]    4    4    2    0    6    6    6    6
[5,]    6    6    6    6    0    2    4    4
[6,]    6    6    6    6    2    0    4    4
[7,]    6    6    6    6    4    4    0    2
[8,]    6    6    6    6    4    4    2    0</code></pre>
</div>
<div id="the-split-decomposition-we-want-1" class="section level2">
<h2>The split decomposition we want</h2>
<p>This is the split decomposition we want.</p>
<pre class="r"><code>l1 &lt;- stats::dist((1/4)*c(1, 1, 1, 1, 0, 0, 0, 0), diag = TRUE, upper = TRUE)
l2 &lt;- stats::dist((1/2)*c(1, 1, 0, 0, 0, 0, 0, 0), diag = TRUE, upper = TRUE)
l3 &lt;- stats::dist((1/2)*c(0, 0, 1, 1, 0, 0, 0, 0), diag = TRUE, upper = TRUE)
l4 &lt;- stats::dist((1/2)*c(0, 0, 0, 0, 1, 1, 0, 0), diag = TRUE, upper = TRUE)
l5 &lt;- stats::dist((1/2)*c(0, 0, 0, 0, 0, 0, 1, 1), diag = TRUE, upper = TRUE)
l6 &lt;- stats::dist(c(1, 0, 0, 0, 0, 0, 0, 0), diag = TRUE, upper = TRUE)
l7 &lt;- stats::dist(c(0, 1, 0, 0, 0, 0, 0, 0), diag = TRUE, upper = TRUE)
l8 &lt;- stats::dist(c(0, 0, 1, 0, 0, 0, 0, 0), diag = TRUE, upper = TRUE)
l9 &lt;- stats::dist(c(0, 0, 0, 1, 0, 0, 0, 0), diag = TRUE, upper = TRUE)
l10 &lt;- stats::dist(c(0, 0, 0, 0, 1, 0, 0, 0), diag = TRUE, upper = TRUE)
l11 &lt;- stats::dist(c(0, 0, 0, 0, 0, 1, 0, 0), diag = TRUE, upper = TRUE)
l12 &lt;- stats::dist(c(0, 0, 0, 0, 0, 0, 1, 0), diag = TRUE, upper = TRUE)
l13 &lt;- stats::dist(c(0, 0, 0, 0, 0, 0, 0, 1), diag = TRUE, upper = TRUE)</code></pre>
<pre class="r"><code>#l1 norm is 32+16+8 = 56
32*l1^2 + 4*l2^2 + 4*l3^2 + 4*l4^2 + 4*l5^2 + l6^2 + l7^2 + l8^2 + l9^2 + l10^2 + l11^2 + l12^2 + l13^2</code></pre>
<pre><code>  1 2 3 4 5 6 7 8
1 0 2 4 4 6 6 6 6
2 2 0 4 4 6 6 6 6
3 4 4 0 2 6 6 6 6
4 4 4 2 0 6 6 6 6
5 6 6 6 6 0 2 4 4
6 6 6 6 6 2 0 4 4
7 6 6 6 6 4 4 0 2
8 6 6 6 6 4 4 2 0</code></pre>
<p>The coefficients of this decomposition have l1 norm = 56.</p>
</div>
<div id="using-penalized-regression-with-standardization-to-factorize"
class="section level2">
<h2>Using Penalized Regression with Standardization to Factorize</h2>
<div id="hypothesis-1" class="section level3">
<h3>Hypothesis</h3>
<p>Based off of the 4 population example, I hypothesize that this method
will also work for the 8 population data generated from the balanced
tree. More specifically, I hypothesize that the regression method will
recover the drift factorization.</p>
</div>
<div id="analysis-1" class="section level3">
<h3>Analysis</h3>
<p>This is a heatmap of the distance matrix:</p>
<pre class="r"><code>plot_heatmap(dist_data_8pop$D2)</code></pre>
<p><img src="figure/8-population-example.Rmd/unnamed-chunk-34-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>
<button type="button" class="btn btn-default btn-xs btn-workflowr btn-workflowr-fig" data-toggle="collapse" data-target="#fig-unnamed-chunk-34-1">
Past versions of unnamed-chunk-34-1.png
</button>
</p>
<div id="fig-unnamed-chunk-34-1" class="collapse">
<div class="table-responsive">
<table class="table table-condensed table-hover">
<thead>
<tr>
<th>
Version
</th>
<th>
Author
</th>
<th>
Date
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<a href="https://github.com/xxie6/drift_matrix_factorization/blob/22aaf9bef5672c3058cd44622274ddc9d64ab055/docs/figure/8-population-example.Rmd/unnamed-chunk-34-1.png" target="_blank">22aaf9b</a>
</td>
<td>
Annie Xie
</td>
<td>
2024-08-05
</td>
</tr>
</tbody>
</table>
</div>
</div>
<pre class="r"><code>set.seed(2042)
fit.regression_8pop &lt;- distance_matrix_factorization_standardized(dist_matrix = dist_data_8pop$D2, alpha_l1 = 1)</code></pre>
<pre><code>Warning in nnlm(LLt_options^2, as.matrix(D_lower_vec, ncol = 1), alpha = c(0, :
x does not have a full column rank. Solution may not be unique.</code></pre>
<pre class="r"><code>dist_est_8pop &lt;- fit.regression_8pop$dist_est</code></pre>
<p>This is a heatmap of the estimated distance matrix:</p>
<pre class="r"><code>plot_heatmap(dist_est_8pop)</code></pre>
<p><img src="figure/8-population-example.Rmd/unnamed-chunk-37-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>
<button type="button" class="btn btn-default btn-xs btn-workflowr btn-workflowr-fig" data-toggle="collapse" data-target="#fig-unnamed-chunk-37-1">
Past versions of unnamed-chunk-37-1.png
</button>
</p>
<div id="fig-unnamed-chunk-37-1" class="collapse">
<div class="table-responsive">
<table class="table table-condensed table-hover">
<thead>
<tr>
<th>
Version
</th>
<th>
Author
</th>
<th>
Date
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<a href="https://github.com/xxie6/drift_matrix_factorization/blob/22aaf9bef5672c3058cd44622274ddc9d64ab055/docs/figure/8-population-example.Rmd/unnamed-chunk-37-1.png" target="_blank">22aaf9b</a>
</td>
<td>
Annie Xie
</td>
<td>
2024-08-05
</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>This is a plot of the fitted values vs. observed values:</p>
<pre class="r"><code>ggplot(data = NULL, aes(x = c(dist_data_8pop$D2), y = c(dist_est_8pop))) + geom_point() + geom_abline(intercept = 0, slope = 1, color = &#39;red&#39;) + xlab(&#39;Observed Values&#39;) + ylab(&#39;Fitted Values&#39;)</code></pre>
<p><img src="figure/8-population-example.Rmd/unnamed-chunk-38-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>
<button type="button" class="btn btn-default btn-xs btn-workflowr btn-workflowr-fig" data-toggle="collapse" data-target="#fig-unnamed-chunk-38-1">
Past versions of unnamed-chunk-38-1.png
</button>
</p>
<div id="fig-unnamed-chunk-38-1" class="collapse">
<div class="table-responsive">
<table class="table table-condensed table-hover">
<thead>
<tr>
<th>
Version
</th>
<th>
Author
</th>
<th>
Date
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<a href="https://github.com/xxie6/drift_matrix_factorization/blob/22aaf9bef5672c3058cd44622274ddc9d64ab055/docs/figure/8-population-example.Rmd/unnamed-chunk-38-1.png" target="_blank">22aaf9b</a>
</td>
<td>
Annie Xie
</td>
<td>
2024-08-05
</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>This is a plot of the residuals:</p>
<pre class="r"><code>fit.residuals_8pop &lt;- c(dist_est_8pop) - c(dist_data_8pop$D2)
ggplot(data = NULL, aes(x = c(1:length(fit.residuals_8pop)), y = fit.residuals_8pop)) + geom_point() + geom_hline(yintercept = 0)</code></pre>
<p><img src="figure/8-population-example.Rmd/unnamed-chunk-39-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>
<button type="button" class="btn btn-default btn-xs btn-workflowr btn-workflowr-fig" data-toggle="collapse" data-target="#fig-unnamed-chunk-39-1">
Past versions of unnamed-chunk-39-1.png
</button>
</p>
<div id="fig-unnamed-chunk-39-1" class="collapse">
<div class="table-responsive">
<table class="table table-condensed table-hover">
<thead>
<tr>
<th>
Version
</th>
<th>
Author
</th>
<th>
Date
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<a href="https://github.com/xxie6/drift_matrix_factorization/blob/22aaf9bef5672c3058cd44622274ddc9d64ab055/docs/figure/8-population-example.Rmd/unnamed-chunk-39-1.png" target="_blank">22aaf9b</a>
</td>
<td>
Annie Xie
</td>
<td>
2024-08-05
</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>This is a heatmap of the residuals:</p>
<pre class="r"><code>plot_heatmap(dist_est_8pop - dist_data_8pop$D2)</code></pre>
<p><img src="figure/8-population-example.Rmd/unnamed-chunk-40-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>
<button type="button" class="btn btn-default btn-xs btn-workflowr btn-workflowr-fig" data-toggle="collapse" data-target="#fig-unnamed-chunk-40-1">
Past versions of unnamed-chunk-40-1.png
</button>
</p>
<div id="fig-unnamed-chunk-40-1" class="collapse">
<div class="table-responsive">
<table class="table table-condensed table-hover">
<thead>
<tr>
<th>
Version
</th>
<th>
Author
</th>
<th>
Date
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<a href="https://github.com/xxie6/drift_matrix_factorization/blob/22aaf9bef5672c3058cd44622274ddc9d64ab055/docs/figure/8-population-example.Rmd/unnamed-chunk-40-1.png" target="_blank">22aaf9b</a>
</td>
<td>
Annie Xie
</td>
<td>
2024-08-05
</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>This is the MSE:</p>
<pre class="r"><code>obj_function_from_fit(fit.regression_8pop, 0)</code></pre>
<pre><code>[1] 1</code></pre>
<p>This is the objective function value:</p>
<pre class="r"><code>obj_function_from_fit(fit.regression_8pop, 1)</code></pre>
<pre><code>[1] 29</code></pre>
</div>
<div id="visualization-of-loadings-1" class="section level3">
<h3>Visualization of Loadings</h3>
<pre class="r"><code>dim(fit.regression_8pop$L_est)</code></pre>
<pre><code>[1]  8 16</code></pre>
<p>This is a heatmap of the loadings:</p>
<pre class="r"><code>plot_heatmap(fit.regression_8pop$L_est)</code></pre>
<p><img src="figure/8-population-example.Rmd/unnamed-chunk-44-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>
<button type="button" class="btn btn-default btn-xs btn-workflowr btn-workflowr-fig" data-toggle="collapse" data-target="#fig-unnamed-chunk-44-1">
Past versions of unnamed-chunk-44-1.png
</button>
</p>
<div id="fig-unnamed-chunk-44-1" class="collapse">
<div class="table-responsive">
<table class="table table-condensed table-hover">
<thead>
<tr>
<th>
Version
</th>
<th>
Author
</th>
<th>
Date
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<a href="https://github.com/xxie6/drift_matrix_factorization/blob/22aaf9bef5672c3058cd44622274ddc9d64ab055/docs/figure/8-population-example.Rmd/unnamed-chunk-44-1.png" target="_blank">22aaf9b</a>
</td>
<td>
Annie Xie
</td>
<td>
2024-08-05
</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>This is a heatmap of the standardized loadings:</p>
<pre class="r"><code>plot_heatmap(t(t(fit.regression_8pop$L_est)/apply(fit.regression_8pop$L_est,2, max)))</code></pre>
<p><img src="figure/8-population-example.Rmd/unnamed-chunk-45-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>
<button type="button" class="btn btn-default btn-xs btn-workflowr btn-workflowr-fig" data-toggle="collapse" data-target="#fig-unnamed-chunk-45-1">
Past versions of unnamed-chunk-45-1.png
</button>
</p>
<div id="fig-unnamed-chunk-45-1" class="collapse">
<div class="table-responsive">
<table class="table table-condensed table-hover">
<thead>
<tr>
<th>
Version
</th>
<th>
Author
</th>
<th>
Date
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<a href="https://github.com/xxie6/drift_matrix_factorization/blob/22aaf9bef5672c3058cd44622274ddc9d64ab055/docs/figure/8-population-example.Rmd/unnamed-chunk-45-1.png" target="_blank">22aaf9b</a>
</td>
<td>
Annie Xie
</td>
<td>
2024-08-05
</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>This is a structure plot of the loadings:</p>
<pre class="r"><code>structure_plot_general(fit.regression_8pop$L_est, fit.regression_8pop$L_est, 
                       n_samples = 8,
                       plot.colors = c(&#39;red&#39;,&#39;blue&#39;,&#39;green&#39;,&#39;yellow&#39;,&#39;orange&#39;,&#39;pink&#39;,&#39;purple&#39;,&#39;brown4&#39;,&#39;gray&#39;,&#39;skyblue&#39;,&#39;darkgreen&#39;,&#39;magenta&#39;,&#39;darkseagreen1&#39;, &#39;darkslategray&#39;, &#39;gold&#39;,&#39;navy&#39;),
                       normalize = FALSE)</code></pre>
<p><img src="figure/8-population-example.Rmd/unnamed-chunk-46-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>
<button type="button" class="btn btn-default btn-xs btn-workflowr btn-workflowr-fig" data-toggle="collapse" data-target="#fig-unnamed-chunk-46-1">
Past versions of unnamed-chunk-46-1.png
</button>
</p>
<div id="fig-unnamed-chunk-46-1" class="collapse">
<div class="table-responsive">
<table class="table table-condensed table-hover">
<thead>
<tr>
<th>
Version
</th>
<th>
Author
</th>
<th>
Date
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<a href="https://github.com/xxie6/drift_matrix_factorization/blob/22aaf9bef5672c3058cd44622274ddc9d64ab055/docs/figure/8-population-example.Rmd/unnamed-chunk-46-1.png" target="_blank">22aaf9b</a>
</td>
<td>
Annie Xie
</td>
<td>
2024-08-05
</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>This is a structure plot of the squared loadings:</p>
<pre class="r"><code>structure_plot_general(fit.regression_8pop$L_est^2, fit.regression_8pop$L_est^2, 
                       n_samples = 8,
                       plot.colors = c(&#39;red&#39;,&#39;blue&#39;,&#39;green&#39;,&#39;yellow&#39;,&#39;orange&#39;,&#39;pink&#39;,&#39;purple&#39;,&#39;brown4&#39;,&#39;gray&#39;,&#39;skyblue&#39;,&#39;darkgreen&#39;,&#39;magenta&#39;,&#39;darkseagreen1&#39;, &#39;darkslategray&#39;, &#39;gold&#39;,&#39;navy&#39;),
                       normalize = FALSE)</code></pre>
<p><img src="figure/8-population-example.Rmd/unnamed-chunk-47-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>
<button type="button" class="btn btn-default btn-xs btn-workflowr btn-workflowr-fig" data-toggle="collapse" data-target="#fig-unnamed-chunk-47-1">
Past versions of unnamed-chunk-47-1.png
</button>
</p>
<div id="fig-unnamed-chunk-47-1" class="collapse">
<div class="table-responsive">
<table class="table table-condensed table-hover">
<thead>
<tr>
<th>
Version
</th>
<th>
Author
</th>
<th>
Date
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<a href="https://github.com/xxie6/drift_matrix_factorization/blob/22aaf9bef5672c3058cd44622274ddc9d64ab055/docs/figure/8-population-example.Rmd/unnamed-chunk-47-1.png" target="_blank">22aaf9b</a>
</td>
<td>
Annie Xie
</td>
<td>
2024-08-05
</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div id="observations-1" class="section level3">
<h3>Observations</h3>
<p>For the penalty weight = 1, the regression method with
standardization returns 16 factors. 4 of these factors have small
coefficient values and thus could potentially be fitting noise. Of the
other 12 factors, 8 of them correspond to population specific effects.
The other four factors correspond to the 2 vs 2 splits that occur for
the nodes containing 4 populations each. These 12 factors are part of
the drift factorization we were hoping to find. One factor from the
drift factorization that is not recovered is the 4 vs 4 split.</p>
<p>The regression method with standardization does seem to choose
sparser loadings vectors. I wonder if the method doesn’t find the 4 vs 4
split because it is not a sparser vector. The inclusion of the 4 vs 4
split improves the fit, but it also increases the l1 norm of the
coefficients by a decent amount.</p>
</div>
</div>
<div
id="using-penalized-regression-without-singleton-factors-to-factorize"
class="section level2">
<h2>Using Penalized Regression (without singleton factors) to
factorize</h2>
<p>I wanted to also test the regression method without the singleton
factors. In theory, the single population effects can be lumped in with
noise. Therefore, I wanted to see if not including singleton factors
changes the recovered factorization.</p>
<div id="hypothesis-2" class="section level3">
<h3>Hypothesis</h3>
<p>I hypothesize that the method will recover the desired 2 vs 6 factors
– these factors were found even when singleton factors were considered.
I hope that the method will recover the desired 4 vs 4 factor now that
we are not considering the singleton factors. However, I’m not sure if
this will be the case.</p>
</div>
<div id="analysis-2" class="section level3">
<h3>Analysis</h3>
<pre class="r"><code>set.seed(2042)
fit.regression_8pop_nosingle &lt;- distance_matrix_factorization_standardized(dist_matrix = dist_data_8pop$D2, alpha_l1 = 1, no_singleton = TRUE)</code></pre>
<pre><code>Warning in nnlm(LLt_options^2, as.matrix(D_lower_vec, ncol = 1), alpha = c(0, :
x does not have a full column rank. Solution may not be unique.</code></pre>
<p>This is the MSE:</p>
<pre class="r"><code>obj_function_from_fit(fit.regression_8pop_nosingle, 0)</code></pre>
<pre><code>[1] 0.25</code></pre>
<p>This is the objective function value:</p>
<pre class="r"><code>obj_function_from_fit(fit.regression_8pop_nosingle, 1)</code></pre>
<pre><code>[1] 43.25</code></pre>
<pre class="r"><code>dim(fit.regression_8pop_nosingle$L_est)</code></pre>
<pre><code>[1]  8 12</code></pre>
<p>This is a heatmap of the loadings:</p>
<pre class="r"><code>plot_heatmap(fit.regression_8pop_nosingle$L_est)</code></pre>
<p><img src="figure/8-population-example.Rmd/unnamed-chunk-52-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>
<button type="button" class="btn btn-default btn-xs btn-workflowr btn-workflowr-fig" data-toggle="collapse" data-target="#fig-unnamed-chunk-52-1">
Past versions of unnamed-chunk-52-1.png
</button>
</p>
<div id="fig-unnamed-chunk-52-1" class="collapse">
<div class="table-responsive">
<table class="table table-condensed table-hover">
<thead>
<tr>
<th>
Version
</th>
<th>
Author
</th>
<th>
Date
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<a href="https://github.com/xxie6/drift_matrix_factorization/blob/22aaf9bef5672c3058cd44622274ddc9d64ab055/docs/figure/8-population-example.Rmd/unnamed-chunk-52-1.png" target="_blank">22aaf9b</a>
</td>
<td>
Annie Xie
</td>
<td>
2024-08-05
</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>This is a heatmap of the standardized loadings:</p>
<pre class="r"><code>plot_heatmap(t(t(fit.regression_8pop_nosingle$L_est)/apply(fit.regression_8pop_nosingle$L_est,2, max)))</code></pre>
<p><img src="figure/8-population-example.Rmd/unnamed-chunk-53-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>
<button type="button" class="btn btn-default btn-xs btn-workflowr btn-workflowr-fig" data-toggle="collapse" data-target="#fig-unnamed-chunk-53-1">
Past versions of unnamed-chunk-53-1.png
</button>
</p>
<div id="fig-unnamed-chunk-53-1" class="collapse">
<div class="table-responsive">
<table class="table table-condensed table-hover">
<thead>
<tr>
<th>
Version
</th>
<th>
Author
</th>
<th>
Date
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<a href="https://github.com/xxie6/drift_matrix_factorization/blob/22aaf9bef5672c3058cd44622274ddc9d64ab055/docs/figure/8-population-example.Rmd/unnamed-chunk-53-1.png" target="_blank">22aaf9b</a>
</td>
<td>
Annie Xie
</td>
<td>
2024-08-05
</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>This is a structure plot of the loadings:</p>
<pre class="r"><code>structure_plot_general(fit.regression_8pop_nosingle$L_est, fit.regression_8pop_nosingle$L_est, 
                       n_samples = 8,
                       plot.colors = c(&#39;red&#39;,&#39;blue&#39;,&#39;green&#39;,&#39;yellow&#39;,&#39;orange&#39;,&#39;pink&#39;,&#39;purple&#39;,&#39;brown4&#39;,&#39;gray&#39;,&#39;skyblue&#39;,&#39;darkgreen&#39;,&#39;magenta&#39;,&#39;darkseagreen1&#39;, &#39;darkslategray&#39;, &#39;gold&#39;,&#39;navy&#39;),
                       normalize = FALSE)</code></pre>
<p><img src="figure/8-population-example.Rmd/unnamed-chunk-54-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>
<button type="button" class="btn btn-default btn-xs btn-workflowr btn-workflowr-fig" data-toggle="collapse" data-target="#fig-unnamed-chunk-54-1">
Past versions of unnamed-chunk-54-1.png
</button>
</p>
<div id="fig-unnamed-chunk-54-1" class="collapse">
<div class="table-responsive">
<table class="table table-condensed table-hover">
<thead>
<tr>
<th>
Version
</th>
<th>
Author
</th>
<th>
Date
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<a href="https://github.com/xxie6/drift_matrix_factorization/blob/22aaf9bef5672c3058cd44622274ddc9d64ab055/docs/figure/8-population-example.Rmd/unnamed-chunk-54-1.png" target="_blank">22aaf9b</a>
</td>
<td>
Annie Xie
</td>
<td>
2024-08-05
</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>This is a structure plot of the squared loadings:</p>
<pre class="r"><code>structure_plot_general(fit.regression_8pop_nosingle$L_est^2, fit.regression_8pop_nosingle$L_est^2, 
                       n_samples = 8,
                       plot.colors = c(&#39;red&#39;,&#39;blue&#39;,&#39;green&#39;,&#39;yellow&#39;,&#39;orange&#39;,&#39;pink&#39;,&#39;purple&#39;,&#39;brown4&#39;,&#39;gray&#39;,&#39;skyblue&#39;,&#39;darkgreen&#39;,&#39;magenta&#39;,&#39;darkseagreen1&#39;, &#39;darkslategray&#39;, &#39;gold&#39;,&#39;navy&#39;),
                       normalize = FALSE)</code></pre>
<p><img src="figure/8-population-example.Rmd/unnamed-chunk-55-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>
<button type="button" class="btn btn-default btn-xs btn-workflowr btn-workflowr-fig" data-toggle="collapse" data-target="#fig-unnamed-chunk-55-1">
Past versions of unnamed-chunk-55-1.png
</button>
</p>
<div id="fig-unnamed-chunk-55-1" class="collapse">
<div class="table-responsive">
<table class="table table-condensed table-hover">
<thead>
<tr>
<th>
Version
</th>
<th>
Author
</th>
<th>
Date
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<a href="https://github.com/xxie6/drift_matrix_factorization/blob/22aaf9bef5672c3058cd44622274ddc9d64ab055/docs/figure/8-population-example.Rmd/unnamed-chunk-55-1.png" target="_blank">22aaf9b</a>
</td>
<td>
Annie Xie
</td>
<td>
2024-08-05
</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div id="observations-2" class="section level3">
<h3>Observations</h3>
<p>The method was able to recover the desired 2 vs 6 factors. However,
it did not recover the desired 4 vs 4 factor. Instead, it seems like the
method used other 2 vs 6 factors to model the single population
effects.</p>
<p>Here is a small example of this phenomenon in the 4 population
case:</p>
<p>The split decomposition we want:</p>
<pre class="r"><code>h1 &lt;- stats::dist((1/2)*c(1, 1, 0, 0), diag = TRUE, upper = TRUE)
h2 &lt;- stats::dist(c(1, 0, 0, 0), diag = TRUE, upper = TRUE)
h3 &lt;- stats::dist(c(0, 1, 0, 0), diag = TRUE, upper = TRUE)
h4 &lt;- stats::dist(c(0, 0, 1, 0), diag = TRUE, upper = TRUE)
h5 &lt;- stats::dist(c(0, 0, 0, 1), diag = TRUE, upper = TRUE)</code></pre>
<pre class="r"><code>8*h1^2 + h2^2 + h3^2 + h4^2 + h5^2</code></pre>
<pre><code>  1 2 3 4
1 0 2 4 4
2 2 0 4 4
3 4 4 0 2
4 4 4 2 0</code></pre>
<p>An alternative split decomposition:</p>
<pre class="r"><code>b1 &lt;- stats::dist((1/2)*c(1,0,1,0), diag = TRUE, upper = TRUE)
b2 &lt;- stats::dist((1/2)*c(0,1,1,0), diag = TRUE, upper = TRUE)
b3 &lt;- stats::dist((1/2)*c(1,0,0,1), diag = TRUE, upper = TRUE)
b4 &lt;- stats::dist((1/2)*c(0,1,0,1), diag = TRUE, upper = TRUE)</code></pre>
<pre class="r"><code>12*h1^2 + (2)*(b1^2 + b2^2 + b3^2 + b4^2)</code></pre>
<pre><code>  1 2 3 4
1 0 2 4 4
2 2 0 4 4
3 4 4 0 2
4 4 4 2 0</code></pre>
</div>
</div>
<div
id="using-penalized-regression-without-standardization-to-factorize"
class="section level2">
<h2>Using Penalized Regression (without Standardization) to
factorize</h2>
<p>For comparison, I wanted to apply the original regression method
(without standardization) to the 8 population data and see what split
metric decomposition it found. Based off of previous experience, I don’t
expect this method to find the drift factorization. A few reasons why
are 1) we do not encode a preference for sparser loadings vectors and 2)
there likely is another decomposition whose coefficients have smaller l1
norm than those of the drift factorization.</p>
<div id="analysis-3" class="section level3">
<h3>Analysis</h3>
<pre class="r"><code>set.seed(2042)
fit.regression &lt;- distance_matrix_factorization(alpha_l1 = 32, dist_matrix = dist_data_8pop$D2)</code></pre>
<pre><code>Warning in nnlm(LLt_options, as.matrix(D_lower_vec, ncol = 1), alpha = c(0, : x
does not have a full column rank. Solution may not be unique.</code></pre>
<p>This is the MSE:</p>
<pre class="r"><code>obj_function_from_fit(fit.regression, 0)</code></pre>
<pre><code>[1] 4</code></pre>
<p>This is the objective function value:</p>
<pre class="r"><code>obj_function_from_fit(fit.regression, 32)</code></pre>
<pre><code>[1] 164</code></pre>
<pre class="r"><code>dim(fit.regression$L_est)</code></pre>
<pre><code>[1]  8 15</code></pre>
<p>This is a heatmap of the loadings:</p>
<pre class="r"><code>plot_heatmap(fit.regression$L_est)</code></pre>
<p><img src="figure/8-population-example.Rmd/unnamed-chunk-64-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>
<button type="button" class="btn btn-default btn-xs btn-workflowr btn-workflowr-fig" data-toggle="collapse" data-target="#fig-unnamed-chunk-64-1">
Past versions of unnamed-chunk-64-1.png
</button>
</p>
<div id="fig-unnamed-chunk-64-1" class="collapse">
<div class="table-responsive">
<table class="table table-condensed table-hover">
<thead>
<tr>
<th>
Version
</th>
<th>
Author
</th>
<th>
Date
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<a href="https://github.com/xxie6/drift_matrix_factorization/blob/22aaf9bef5672c3058cd44622274ddc9d64ab055/docs/figure/8-population-example.Rmd/unnamed-chunk-64-1.png" target="_blank">22aaf9b</a>
</td>
<td>
Annie Xie
</td>
<td>
2024-08-05
</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>This is a heatmap of the standardized loadings:</p>
<pre class="r"><code>plot_heatmap(t(t(fit.regression$L_est)/apply(fit.regression$L_est,2, max)))</code></pre>
<p><img src="figure/8-population-example.Rmd/unnamed-chunk-65-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>
<button type="button" class="btn btn-default btn-xs btn-workflowr btn-workflowr-fig" data-toggle="collapse" data-target="#fig-unnamed-chunk-65-1">
Past versions of unnamed-chunk-65-1.png
</button>
</p>
<div id="fig-unnamed-chunk-65-1" class="collapse">
<div class="table-responsive">
<table class="table table-condensed table-hover">
<thead>
<tr>
<th>
Version
</th>
<th>
Author
</th>
<th>
Date
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<a href="https://github.com/xxie6/drift_matrix_factorization/blob/22aaf9bef5672c3058cd44622274ddc9d64ab055/docs/figure/8-population-example.Rmd/unnamed-chunk-65-1.png" target="_blank">22aaf9b</a>
</td>
<td>
Annie Xie
</td>
<td>
2024-08-05
</td>
</tr>
</tbody>
</table>
</div>
</div>
<pre class="r"><code>structure_plot_general(fit.regression$L_est^2, fit.regression$L_est^2, 
                       n_samples = 8,
                       plot.colors = c(&#39;red&#39;,&#39;blue&#39;,&#39;green&#39;,&#39;yellow&#39;,&#39;orange&#39;,&#39;pink&#39;,&#39;purple&#39;,&#39;brown4&#39;,&#39;gray&#39;,&#39;skyblue&#39;,&#39;darkgreen&#39;,&#39;magenta&#39;,&#39;darkseagreen1&#39;, &#39;darkslategray&#39;, &#39;gold&#39;,&#39;navy&#39;),
                       normalize = FALSE)</code></pre>
<p><img src="figure/8-population-example.Rmd/unnamed-chunk-66-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>
<button type="button" class="btn btn-default btn-xs btn-workflowr btn-workflowr-fig" data-toggle="collapse" data-target="#fig-unnamed-chunk-66-1">
Past versions of unnamed-chunk-66-1.png
</button>
</p>
<div id="fig-unnamed-chunk-66-1" class="collapse">
<div class="table-responsive">
<table class="table table-condensed table-hover">
<thead>
<tr>
<th>
Version
</th>
<th>
Author
</th>
<th>
Date
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<a href="https://github.com/xxie6/drift_matrix_factorization/blob/22aaf9bef5672c3058cd44622274ddc9d64ab055/docs/figure/8-population-example.Rmd/unnamed-chunk-66-1.png" target="_blank">22aaf9b</a>
</td>
<td>
Annie Xie
</td>
<td>
2024-08-05
</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div id="observations-3" class="section level3">
<h3>Observations</h3>
<p>As I hypothesized, the original regression method did not recover the
drift factorization. For the penalty weight = 32, the method returned 15
factors. However, most of the factors have a very small coefficient and
possibly are just fitting noise. There are three main factors that don’t
have small coefficients. One of the factors corresponds to the first
split of the tree, differentiating the first four populations from the
latter four. The other two factors are also 4 vs. 4 splits. However, the
splits do not align with the branches of the tree used to generate the
data. This is similar to what we saw in the 4 population example.</p>
</div>
</div>
</div>
<div id="population-example-with-noise" class="section level1">
<h1>8 Population Example (with noise)</h1>
<p>In this example, I generate a population <span
class="math inline">\(\times\)</span> genes data set, <span
class="math inline">\(Y\)</span>, with random normal noise. Then I
compute the distance matrix using the Gram matrix, <span
class="math inline">\(YY^{T}\)</span>. I was mainly curious to see if
adding some noise leads to different results (compared to the previous
example with no noise).</p>
<div id="data-generation-2" class="section level2">
<h2>Data Generation</h2>
<pre class="r"><code># modified from Jason&#39;s code
sim_8pops_with_noise &lt;- function(indiv_sd, num_genes,
                                 constrain_F = TRUE,
                                 seed = 666) {
  set.seed(seed)

  n &lt;- 8
  p &lt;- num_genes
  branch_sds &lt;- rep(1, 15)

  LL &lt;- matrix(0, nrow = n, ncol = 15)
  LL[, 1] &lt;- 1
  LL[, 2] &lt;- c(1, 1, 1, 1, 0, 0, 0, 0)
  LL[, 3] &lt;- c(0, 0, 0, 0, 1, 1, 1, 1)
  LL[, 4] &lt;- c(1, 1, 0, 0, 0, 0, 0, 0)
  LL[, 5] &lt;- c(0, 0, 1, 1, 0, 0, 0, 0)
  LL[, 6] &lt;- c(0, 0, 0, 0, 1, 1, 0, 0)
  LL[, 7] &lt;- c(0, 0, 0, 0, 0, 0, 1, 1)
  LL[, c(8:15)] &lt;- diag(rep(1, 8))
  
  FF &lt;- matrix(rnorm(15 * p, sd = rep(branch_sds, each = p)), ncol = 15)
  if (constrain_F) {
    FF_svd &lt;- svd(FF)
    FF &lt;- FF_svd$u
    FF &lt;- t(t(FF) * branch_sds * sqrt(p))
  }
  
  E &lt;- matrix(rnorm(n * p, sd = indiv_sd), nrow = n)
  Y &lt;- LL %*% t(FF)  + E
  YYt &lt;- tcrossprod(Y)
  D2 &lt;- compute_distance(crossprod_X = YYt)
  
  return(list(D2 = D2, Y = Y, LL = LL, FF = FF))
}</code></pre>
<pre class="r"><code>dist_data_8pop_noise &lt;- sim_8pops_with_noise(indiv_sd = 0.5, num_genes = 20)</code></pre>
<pre class="r"><code>dist_data_8pop_noise$D2</code></pre>
<pre><code>          [,1]      [,2]      [,3]      [,4]      [,5]      [,6]      [,7]
[1,]   0.00000  34.27869  94.55264  94.39914 135.83613 120.40316 120.96735
[2,]  34.27869   0.00000  96.83035  84.21821 147.77119 143.74758 136.44586
[3,]  94.55264  96.83035   0.00000  44.01988 140.93334 119.60892 112.21649
[4,]  94.39914  84.21821  44.01988   0.00000 155.17544 133.97381 111.41930
[5,] 135.83613 147.77119 140.93334 155.17544   0.00000  43.69335 110.89088
[6,] 120.40316 143.74758 119.60892 133.97381  43.69335   0.00000  84.25019
[7,] 120.96735 136.44586 112.21649 111.41930 110.89088  84.25019   0.00000
[8,] 136.40551 150.83729 128.69999 132.35899 110.59976  79.06088  54.76275
          [,8]
[1,] 136.40551
[2,] 150.83729
[3,] 128.69999
[4,] 132.35899
[5,] 110.59976
[6,]  79.06088
[7,]  54.76275
[8,]   0.00000</code></pre>
</div>
<div id="using-penalized-regression-with-standardization-to-factorize-1"
class="section level2">
<h2>Using Penalized Regression with Standardization to Factorize</h2>
<div id="hypothesis-3" class="section level3">
<h3>Hypothesis</h3>
<p>I hypothesize that the decomposition found is similar to that found
in the previous example with no noise.</p>
</div>
<div id="analysis-4" class="section level3">
<h3>Analysis</h3>
<p>This is a heatmap of the distance matrix:</p>
<pre class="r"><code>plot_heatmap(dist_data_8pop_noise$D2)</code></pre>
<p><img src="figure/8-population-example.Rmd/unnamed-chunk-70-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>
<button type="button" class="btn btn-default btn-xs btn-workflowr btn-workflowr-fig" data-toggle="collapse" data-target="#fig-unnamed-chunk-70-1">
Past versions of unnamed-chunk-70-1.png
</button>
</p>
<div id="fig-unnamed-chunk-70-1" class="collapse">
<div class="table-responsive">
<table class="table table-condensed table-hover">
<thead>
<tr>
<th>
Version
</th>
<th>
Author
</th>
<th>
Date
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<a href="https://github.com/xxie6/drift_matrix_factorization/blob/22aaf9bef5672c3058cd44622274ddc9d64ab055/docs/figure/8-population-example.Rmd/unnamed-chunk-70-1.png" target="_blank">22aaf9b</a>
</td>
<td>
Annie Xie
</td>
<td>
2024-08-05
</td>
</tr>
</tbody>
</table>
</div>
</div>
<pre class="r"><code>set.seed(2042)
fit.regression_8pop_noise &lt;- distance_matrix_factorization_standardized(dist_matrix = dist_data_8pop_noise$D2, alpha_l1 = 31)</code></pre>
<pre><code>Warning in nnlm(LLt_options^2, as.matrix(D_lower_vec, ncol = 1), alpha = c(0, :
x does not have a full column rank. Solution may not be unique.</code></pre>
<pre class="r"><code>dist_est_8pop_noise &lt;- fit.regression_8pop_noise$dist_est</code></pre>
<p>This is a heatmap of the estimated distance matrix:</p>
<pre class="r"><code>plot_heatmap(dist_est_8pop_noise)</code></pre>
<p><img src="figure/8-population-example.Rmd/unnamed-chunk-73-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>
<button type="button" class="btn btn-default btn-xs btn-workflowr btn-workflowr-fig" data-toggle="collapse" data-target="#fig-unnamed-chunk-73-1">
Past versions of unnamed-chunk-73-1.png
</button>
</p>
<div id="fig-unnamed-chunk-73-1" class="collapse">
<div class="table-responsive">
<table class="table table-condensed table-hover">
<thead>
<tr>
<th>
Version
</th>
<th>
Author
</th>
<th>
Date
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<a href="https://github.com/xxie6/drift_matrix_factorization/blob/22aaf9bef5672c3058cd44622274ddc9d64ab055/docs/figure/8-population-example.Rmd/unnamed-chunk-73-1.png" target="_blank">22aaf9b</a>
</td>
<td>
Annie Xie
</td>
<td>
2024-08-05
</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>This is a plot of the fitted values vs. observed values:</p>
<pre class="r"><code>ggplot(data = NULL, aes(x = c(dist_data_8pop_noise$D2), y = c(dist_est_8pop_noise))) + geom_point() + geom_abline(intercept = 0, slope = 1, color = &#39;red&#39;) + xlab(&#39;Observed Values&#39;) + ylab(&#39;Fitted Values&#39;) </code></pre>
<p><img src="figure/8-population-example.Rmd/unnamed-chunk-74-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>
<button type="button" class="btn btn-default btn-xs btn-workflowr btn-workflowr-fig" data-toggle="collapse" data-target="#fig-unnamed-chunk-74-1">
Past versions of unnamed-chunk-74-1.png
</button>
</p>
<div id="fig-unnamed-chunk-74-1" class="collapse">
<div class="table-responsive">
<table class="table table-condensed table-hover">
<thead>
<tr>
<th>
Version
</th>
<th>
Author
</th>
<th>
Date
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<a href="https://github.com/xxie6/drift_matrix_factorization/blob/22aaf9bef5672c3058cd44622274ddc9d64ab055/docs/figure/8-population-example.Rmd/unnamed-chunk-74-1.png" target="_blank">22aaf9b</a>
</td>
<td>
Annie Xie
</td>
<td>
2024-08-05
</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>This is a plot of the residuals:</p>
<pre class="r"><code>fit.residuals_8pop_noise &lt;- c(dist_data_8pop_noise$D2) - c(dist_est_8pop_noise)
ggplot(data = NULL, aes(x = c(1:length(fit.residuals_8pop_noise)), y = fit.residuals_8pop_noise)) + geom_point() + geom_hline(yintercept = 0)</code></pre>
<p><img src="figure/8-population-example.Rmd/unnamed-chunk-75-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>
<button type="button" class="btn btn-default btn-xs btn-workflowr btn-workflowr-fig" data-toggle="collapse" data-target="#fig-unnamed-chunk-75-1">
Past versions of unnamed-chunk-75-1.png
</button>
</p>
<div id="fig-unnamed-chunk-75-1" class="collapse">
<div class="table-responsive">
<table class="table table-condensed table-hover">
<thead>
<tr>
<th>
Version
</th>
<th>
Author
</th>
<th>
Date
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<a href="https://github.com/xxie6/drift_matrix_factorization/blob/22aaf9bef5672c3058cd44622274ddc9d64ab055/docs/figure/8-population-example.Rmd/unnamed-chunk-75-1.png" target="_blank">22aaf9b</a>
</td>
<td>
Annie Xie
</td>
<td>
2024-08-05
</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>This is a heatmap of the residuals:</p>
<pre class="r"><code>plot_heatmap(dist_data_8pop_noise$D2 - dist_est_8pop_noise)</code></pre>
<p><img src="figure/8-population-example.Rmd/unnamed-chunk-76-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>
<button type="button" class="btn btn-default btn-xs btn-workflowr btn-workflowr-fig" data-toggle="collapse" data-target="#fig-unnamed-chunk-76-1">
Past versions of unnamed-chunk-76-1.png
</button>
</p>
<div id="fig-unnamed-chunk-76-1" class="collapse">
<div class="table-responsive">
<table class="table table-condensed table-hover">
<thead>
<tr>
<th>
Version
</th>
<th>
Author
</th>
<th>
Date
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<a href="https://github.com/xxie6/drift_matrix_factorization/blob/22aaf9bef5672c3058cd44622274ddc9d64ab055/docs/figure/8-population-example.Rmd/unnamed-chunk-76-1.png" target="_blank">22aaf9b</a>
</td>
<td>
Annie Xie
</td>
<td>
2024-08-05
</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>This is the MSE:</p>
<pre class="r"><code>obj_function_from_fit(fit.regression_8pop_noise, 0)</code></pre>
<pre><code>[1] 557.5629</code></pre>
<p>This is the objective function value:</p>
<pre class="r"><code>obj_function_from_fit(fit.regression_8pop_noise, 20)</code></pre>
<pre><code>[1] 12099.82</code></pre>
</div>
<div id="visualization-of-loadings-2" class="section level3">
<h3>Visualization of Loadings</h3>
<pre class="r"><code>dim(fit.regression_8pop_noise$L_est)</code></pre>
<pre><code>[1]  8 12</code></pre>
<p>This is a heatmap of the loadings:</p>
<pre class="r"><code>plot_heatmap(fit.regression_8pop_noise$L_est)</code></pre>
<p><img src="figure/8-population-example.Rmd/unnamed-chunk-80-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>
<button type="button" class="btn btn-default btn-xs btn-workflowr btn-workflowr-fig" data-toggle="collapse" data-target="#fig-unnamed-chunk-80-1">
Past versions of unnamed-chunk-80-1.png
</button>
</p>
<div id="fig-unnamed-chunk-80-1" class="collapse">
<div class="table-responsive">
<table class="table table-condensed table-hover">
<thead>
<tr>
<th>
Version
</th>
<th>
Author
</th>
<th>
Date
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<a href="https://github.com/xxie6/drift_matrix_factorization/blob/22aaf9bef5672c3058cd44622274ddc9d64ab055/docs/figure/8-population-example.Rmd/unnamed-chunk-80-1.png" target="_blank">22aaf9b</a>
</td>
<td>
Annie Xie
</td>
<td>
2024-08-05
</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>This is a heatmap of the standardized loadings:</p>
<pre class="r"><code>plot_heatmap(t(t(fit.regression_8pop_noise$L_est)/apply(fit.regression_8pop_noise$L_est,2, max)))</code></pre>
<p><img src="figure/8-population-example.Rmd/unnamed-chunk-81-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>
<button type="button" class="btn btn-default btn-xs btn-workflowr btn-workflowr-fig" data-toggle="collapse" data-target="#fig-unnamed-chunk-81-1">
Past versions of unnamed-chunk-81-1.png
</button>
</p>
<div id="fig-unnamed-chunk-81-1" class="collapse">
<div class="table-responsive">
<table class="table table-condensed table-hover">
<thead>
<tr>
<th>
Version
</th>
<th>
Author
</th>
<th>
Date
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<a href="https://github.com/xxie6/drift_matrix_factorization/blob/22aaf9bef5672c3058cd44622274ddc9d64ab055/docs/figure/8-population-example.Rmd/unnamed-chunk-81-1.png" target="_blank">22aaf9b</a>
</td>
<td>
Annie Xie
</td>
<td>
2024-08-05
</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>This is a structure plot of the loadings:</p>
<pre class="r"><code>structure_plot_general(fit.regression_8pop_noise$L_est, fit.regression_8pop_noise$L_est, 
                       n_samples = 8,
                       plot.colors = c(&#39;red&#39;,&#39;blue&#39;,&#39;green&#39;,&#39;yellow&#39;,&#39;orange&#39;,&#39;pink&#39;,&#39;purple&#39;,&#39;brown4&#39;,&#39;gray&#39;,&#39;skyblue&#39;,&#39;darkgreen&#39;,&#39;magenta&#39;), normalize = FALSE)</code></pre>
<p><img src="figure/8-population-example.Rmd/unnamed-chunk-82-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>
<button type="button" class="btn btn-default btn-xs btn-workflowr btn-workflowr-fig" data-toggle="collapse" data-target="#fig-unnamed-chunk-82-1">
Past versions of unnamed-chunk-82-1.png
</button>
</p>
<div id="fig-unnamed-chunk-82-1" class="collapse">
<div class="table-responsive">
<table class="table table-condensed table-hover">
<thead>
<tr>
<th>
Version
</th>
<th>
Author
</th>
<th>
Date
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<a href="https://github.com/xxie6/drift_matrix_factorization/blob/22aaf9bef5672c3058cd44622274ddc9d64ab055/docs/figure/8-population-example.Rmd/unnamed-chunk-82-1.png" target="_blank">22aaf9b</a>
</td>
<td>
Annie Xie
</td>
<td>
2024-08-05
</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>This is a structure plot of the squared loadings:</p>
<pre class="r"><code>structure_plot_general(fit.regression_8pop_noise$L_est^2, fit.regression_8pop_noise$L_est^2, 
                       n_samples = 8,
                       plot.colors = c(&#39;red&#39;,&#39;blue&#39;,&#39;green&#39;,&#39;yellow&#39;,&#39;orange&#39;,&#39;pink&#39;,&#39;purple&#39;,&#39;brown4&#39;,&#39;gray&#39;,&#39;skyblue&#39;,&#39;darkgreen&#39;,&#39;magenta&#39;), normalize = FALSE)</code></pre>
<p><img src="figure/8-population-example.Rmd/unnamed-chunk-83-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>
<button type="button" class="btn btn-default btn-xs btn-workflowr btn-workflowr-fig" data-toggle="collapse" data-target="#fig-unnamed-chunk-83-1">
Past versions of unnamed-chunk-83-1.png
</button>
</p>
<div id="fig-unnamed-chunk-83-1" class="collapse">
<div class="table-responsive">
<table class="table table-condensed table-hover">
<thead>
<tr>
<th>
Version
</th>
<th>
Author
</th>
<th>
Date
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<a href="https://github.com/xxie6/drift_matrix_factorization/blob/22aaf9bef5672c3058cd44622274ddc9d64ab055/docs/figure/8-population-example.Rmd/unnamed-chunk-83-1.png" target="_blank">22aaf9b</a>
</td>
<td>
Annie Xie
</td>
<td>
2024-08-05
</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div id="observations-4" class="section level3">
<h3>Observations</h3>
<p>The decomposition found is similar to that found in the no noise
example. We find 8 population specific factors. We also find the four 2
vs 2 factors that split the nodes containing 4 populations.</p>
<br>
<p>
<button type="button" class="btn btn-default btn-workflowr btn-workflowr-sessioninfo" data-toggle="collapse" data-target="#workflowr-sessioninfo" style="display: block;">
<span class="glyphicon glyphicon-wrench" aria-hidden="true"></span>
Session information
</button>
</p>
<div id="workflowr-sessioninfo" class="collapse">
<pre class="r"><code>sessionInfo()</code></pre>
<pre><code>R version 4.3.2 (2023-10-31)
Platform: aarch64-apple-darwin20 (64-bit)
Running under: macOS Sonoma 14.4.1

Matrix products: default
BLAS:   /Library/Frameworks/R.framework/Versions/4.3-arm64/Resources/lib/libRblas.0.dylib 
LAPACK: /Library/Frameworks/R.framework/Versions/4.3-arm64/Resources/lib/libRlapack.dylib;  LAPACK version 3.11.0

locale:
[1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8

time zone: America/Chicago
tzcode source: internal

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base     

other attached packages:
[1] NNLM_0.4.4      pheatmap_1.0.12 ggplot2_3.5.1   workflowr_1.7.1

loaded via a namespace (and not attached):
 [1] tidyselect_1.2.1   viridisLite_0.4.2  dplyr_1.1.4        farver_2.1.2      
 [5] fastmap_1.2.0      lazyeval_0.2.2     promises_1.3.0     digest_0.6.35     
 [9] lifecycle_1.0.4    survival_3.6-4     processx_3.8.4     invgamma_1.1      
[13] magrittr_2.0.3     compiler_4.3.2     rlang_1.1.3        sass_0.4.9        
[17] progress_1.2.3     tools_4.3.2        utf8_1.2.4         yaml_2.3.8        
[21] data.table_1.15.4  knitr_1.45         prettyunits_1.2.0  labeling_0.4.3    
[25] htmlwidgets_1.6.4  RColorBrewer_1.1-3 Rtsne_0.17         withr_3.0.0       
[29] purrr_1.0.2        grid_4.3.2         fansi_1.0.6        git2r_0.33.0      
[33] fastTopics_0.6-142 colorspace_2.1-0   scales_1.3.0       MASS_7.3-60.0.1   
[37] mcmc_0.9-8         cli_3.6.2          crayon_1.5.2       rmarkdown_2.27    
[41] generics_0.1.3     RcppParallel_5.1.7 rstudioapi_0.16.0  httr_1.4.7        
[45] pbapply_1.7-2      cachem_1.1.0       stringr_1.5.1      splines_4.3.2     
[49] parallel_4.3.2     vctrs_0.6.5        Matrix_1.6-5       jsonlite_1.8.8    
[53] SparseM_1.81       callr_3.7.6        hms_1.1.3          MCMCpack_1.7-0    
[57] mixsqp_0.3-54      ggrepel_0.9.5      irlba_2.3.5.1      plotly_4.10.4     
[61] jquerylib_0.1.4    tidyr_1.3.1        glue_1.7.0         ps_1.7.6          
[65] uwot_0.1.16        cowplot_1.1.3      stringi_1.8.4      gtable_0.3.5      
[69] later_1.3.2        quadprog_1.5-8     munsell_0.5.1      tibble_3.2.1      
[73] pillar_1.9.0       htmltools_0.5.8.1  quantreg_5.97      truncnorm_1.0-9   
[77] R6_2.5.1           rprojroot_2.0.4    evaluate_0.23      lattice_0.22-6    
[81] highr_0.11         SQUAREM_2021.1     ashr_2.2-66        httpuv_1.6.15     
[85] bslib_0.7.0        MatrixModels_0.5-3 Rcpp_1.0.12        coda_0.19-4.1     
[89] whisker_0.4.1      xfun_0.44          fs_1.6.4           getPass_0.2-4     
[93] pkgconfig_2.0.3   </code></pre>
</div>
</div>
</div>
</div>


<!-- Adjust MathJax settings so that all math formulae are shown using
TeX fonts only; see
https://docs.mathjax.org/en/latest/web/configuration.html. This will make
the presentation more consistent at the cost of the webpage sometimes
taking slightly longer to load. Note that this only works because the
footer is added to webpages before the MathJax javascript. -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    "HTML-CSS": { availableFonts: ["TeX"] }
  });
</script>




</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->

<script>
$(document).ready(function ()  {

    // temporarily add toc-ignore selector to headers for the consistency with Pandoc
    $('.unlisted.unnumbered').addClass('toc-ignore')

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
